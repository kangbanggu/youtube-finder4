<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>YouTube Finder Pro</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9fafb; }
    input, select, button { margin: 5px; padding: 8px; }
    .video-card {
      display: inline-block; vertical-align: top; margin: 10px;
      width: 260px; background: white; padding: 10px; border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    img { width: 100%; border-radius: 8px; }
    #quotaBox { margin-top: 10px; font-weight: bold; color: #444; }
    #pagination { margin-top: 20px; }
    button.page { margin: 5px; padding: 8px 12px; background: #2563eb; color: white; border: none; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>ğŸ“Š YouTube Finder Pro</h2>
  
  ğŸ” ê²€ìƒ‰ì–´:
  <input id="query" placeholder="ì˜ˆ: ë³µì§€, ì‹œë‹ˆì–´, ê±´ê°•">
  <button onclick="searchVideos()">ê²€ìƒ‰</button>

  <div id="quotaBox">API ì‚¬ìš©ëŸ‰: 0 / 10,000</div>
  <div id="results"></div>
  <div id="pagination"></div>

  <script>
    const API_KEY = "AIzaSyBMA6UbKczjPJkqExjd4_evvq3nUz-Agi8"; // ğŸ‘‰ ì—¬ê¸°ì— ë³¸ì¸ APIí‚¤ ë„£ê¸°
    let nextPageToken = "";
    let prevPageToken = "";
    let totalQuota = 10000;
    let usedQuota = 0;
    let currentQuery = "";

    async function searchVideos(pageToken = "") {
      const query = document.getElementById("query").value || currentQuery;
      currentQuery = query;

      // search.list í˜¸ì¶œ (100 quota)
      usedQuota += 100;
      updateQuota();

      const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&maxResults=6&pageToken=${pageToken}&key=${API_KEY}`;

      const res = await fetch(searchUrl);
      const data = await res.json();

      nextPageToken = data.nextPageToken || "";
      prevPageToken = data.prevPageToken || "";

      const videoIds = data.items.map(i => i.id.videoId).join(",");
      
      // videos.list í˜¸ì¶œ (1 quota Ã— ì˜ìƒ ìˆ˜)
      usedQuota += data.items.length;
      updateQuota();

      const videoRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails,snippet&id=${videoIds}&key=${API_KEY}`);
      const videoData = await videoRes.json();

      displayResults(videoData.items);
      updatePagination();
    }

    function displayResults(videos) {
      const container = document.getElementById("results");
      container.innerHTML = "";
      videos.forEach(v => {
        const duration = parseDuration(v.contentDetails.duration);
        const viewCount = Number(v.statistics.viewCount).toLocaleString();
        const subs = v.statistics.subscriberCount ? v.statistics.subscriberCount : "N/A";
        const ratio = v.statistics.viewCount / (v.statistics.subscriberCount || 1);
        const efficiency = ratio.toFixed(2);

        const div = document.createElement("div");
        div.className = "video-card";
        div.innerHTML = `
          <img src="${v.snippet.thumbnails.medium.url}" alt="thumb">
          <h4>${v.snippet.title}</h4>
          <p>ì¡°íšŒìˆ˜: ${viewCount}</p>
          <p>ì˜ìƒê¸¸ì´: ${duration}</p>
          <p>ì¡°íšŒ íš¨ìœ¨: ${efficiency}</p>
        `;
        container.appendChild(div);
      });
    }

    function updatePagination() {
      const pagediv = document.getElementById("pagination");
      pagediv.innerHTML = "";
      if (prevPageToken) {
        const prev = document.createElement("button");
        prev.className = "page";
        prev.textContent = "ì´ì „ í˜ì´ì§€";
        prev.onclick = () => searchVideos(prevPageToken);
        pagediv.appendChild(prev);
      }
      if (nextPageToken) {
        const next = document.createElement("button");
        next.className = "page";
        next.textContent = "ë‹¤ìŒ í˜ì´ì§€";
        next.onclick = () => searchVideos(nextPageToken);
        pagediv.appendChild(next);
      }
    }

    function updateQuota() {
      document.getElementById("quotaBox").textContent = `API ì‚¬ìš©ëŸ‰: ${usedQuota} / ${totalQuota}`;
    }

    function parseDuration(duration) {
      const match = duration.match(/PT(\d+M)?(\d+S)?/);
      const mins = match[1] ? match[1].replace("M", "") : "0";
      const secs = match[2] ? match[2].replace("S", "") : "0";
      return `${mins}ë¶„ ${secs}ì´ˆ`;
    }
  </script>
</body>
</html>
