<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SmartTube Finder â€” ë²¤ì¹˜ë§ˆí‚¹</title>
<style>
  :root{--accent:#e60023;--muted:#6b7280}
  body{font-family:Noto Sans KR, Arial, sans-serif;background:#f7fafc;margin:0;padding:18px;color:#111}
  .wrap{max-width:980px;margin:0 auto}
  h1{color:var(--accent);text-align:center;margin:6px 0 18px}
  .box{background:#fff;padding:12px;border-radius:12px;box-shadow:0 4px 18px rgba(10,10,10,0.06);margin-bottom:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  input,select,button{padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;font-size:14px}
  button{background:var(--accent);color:#fff;border:none;cursor:pointer}
  .filters{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  #results{display:grid;gap:12px;margin-top:12px}
  .card{background:#fff;border-radius:10px;padding:10px;display:grid;grid-template-columns:140px 1fr;gap:10px;align-items:start;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
  .thumb{width:100%;height:92px;object-fit:cover;border-radius:8px}
  .title{font-weight:700;margin:0 0 6px}
  .meta{font-size:13px;color:#374151}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;background:#f3f4f6;margin-right:6px}
  .ratio-good{color:#16a34a;font-weight:700}
  .ratio-bad{color:#dc2626;font-weight:700}
  .small{font-size:12px;color:#6b7280}
  .note{font-size:13px;color:#6b7280;margin-top:6px}
  @media(max-width:640px){.card{grid-template-columns:120px 1fr}.thumb{height:80px}}
  .section-title{margin:12px 0 6px;font-weight:700}
  #usageCounter { text-align:right; font-size:13px; color:#555; margin-bottom:8px; }
  .pagination { text-align:center; margin-top:20px; }
  .pagination button { margin:0 4px; padding:6px 10px; border-radius:6px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ“ˆ SmartTube Finder â€” ë²¤ì¹˜ë§ˆí‚¹</h1>

  <div id="usageCounter">API ì‚¬ìš©ëŸ‰: 0íšŒ</div> <!-- âœ… ì‚¬ìš©ëŸ‰ í‘œì‹œ ì¶”ê°€ -->

  <div class="box">
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <input id="q" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (ì˜ˆ: ë³µì§€ ì‚¬ì—°, ê±´ê°•, ë‹¤ì´ì–´íŠ¸)" style="flex:1" />
      <button id="searchBtn">ê²€ìƒ‰</button>
    </div>

    <div style="margin-top:10px" class="filters">
      <div><label>êµ¬ë¶„ (íƒ€ì…)</label>
        <select id="typeFilter"><option value="any">ì „ì²´</option><option value="video">ì¼ë°˜ì˜ìƒ</option><option value="shorts">ì‡¼ì¸ </option><option value="live">ë¼ì´ë¸Œ</option><option value="channel">ì±„ë„</option></select>
      </div>

      <div><label>ì—…ë¡œë“œ ê¸°ê°„</label>
        <select id="timeFilter"><option value="any">ì „ì²´</option><option value="today">ì˜¤ëŠ˜</option><option value="week">ìµœê·¼ 1ì£¼</option><option value="month">ì´ë²ˆ ë‹¬</option><option value="3months">3ê°œì›”</option><option value="6months">6ê°œì›”</option><option value="year">ì˜¬í•´</option></select>
      </div>

      <div><label>ì¡°íšŒìˆ˜ (ìµœì†Œ ~ ìµœëŒ€)</label>
        <div style="display:flex;gap:6px"><input id="minViews" type="number" placeholder="ìµœì†Œ"/><input id="maxViews" type="number" placeholder="ìµœëŒ€"/></div>
      </div>

      <div><label>êµ¬ë…ì (ìµœì†Œ ~ ìµœëŒ€)</label>
        <div style="display:flex;gap:6px"><input id="minSubs" type="number" placeholder="ìµœì†Œ"/><input id="maxSubs" type="number" placeholder="ìµœëŒ€"/></div>
      </div>

      <div><label>ì •ë ¬</label>
        <select id="sortBy"><option value="ratio">íš¨ìœ¨ìˆœ</option><option value="views">ì¡°íšŒìˆ˜ ìˆœ</option><option value="subs">êµ¬ë…ì ìˆœ</option></select>
      </div>

      <div><label>ê²°ê³¼ ê°¯ìˆ˜</label>
        <select id="maxResults"><option value="10">10</option><option value="20" selected>20</option><option value="30">30</option></select>
      </div>
    </div>
    <div class="note">ì„¤ëª…: ì‡¼ì¸  = < 4ë¶„, ì¼ë°˜ë™ì˜ìƒ = â‰¥ 5ë¶„, 4:00~4:59 êµ¬ê°„ì€ 'ì¤‘ê°„'ìœ¼ë¡œ ë”°ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>

  <div id="results">
    <div class="box"><div class="section-title">ğŸ¬ ì‡¼ì¸  (4ë¶„ ë¯¸ë§Œ)</div><div id="shorts"></div></div>
    <div class="box"><div class="section-title">â¸ 4-5ë¶„ (ì¤‘ê°„)</div><div id="mid"></div></div>
    <div class="box"><div class="section-title">ğŸ“º ì¼ë°˜ë™ì˜ìƒ (5ë¶„ ì´ìƒ)</div><div id="longs"></div></div>
    <div class="box"><div class="section-title">ğŸ“ ì±„ë„ ê²°ê³¼</div><div id="channels"></div></div>
  </div>

  <div class="pagination" id="pagination"></div> <!-- âœ… í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ ì¶”ê°€ -->
  <div id="status" class="small" style="margin-top:10px"></div>
</div>

<script>
const API_KEY = "AIzaSyBMA6UbKczjPJkqExjd4_evvq3nUz-Agi8"; // ë³¸ì¸ API í‚¤ ì…ë ¥
let apiUsage = 0;
let currentPage = 1;
const itemsPerPage = 10;
let allRows = [];

function updateUsage(){
  document.getElementById("usageCounter").textContent = `API ì‚¬ìš©ëŸ‰: ${apiUsage}íšŒ`;
}

// í˜ì´ì§€ ë Œë”ë§
function renderPage(page){
  const shortsEl = document.getElementById('shorts');
  const midEl = document.getElementById('mid');
  const longsEl = document.getElementById('longs');
  const channelsEl = document.getElementById('channels');
  shortsEl.innerHTML = midEl.innerHTML = longsEl.innerHTML = channelsEl.innerHTML = "";

  const start = (page - 1) * itemsPerPage;
  const end = start + itemsPerPage;
  const pageItems = allRows.slice(start, end);

  for(const r of pageItems){
    const html = renderCard(r,'video');
    if(r.kind==='channel') channelsEl.insertAdjacentHTML('beforeend', html);
    else if(r.isShort) shortsEl.insertAdjacentHTML('beforeend', html);
    else if(r.isMid) midEl.insertAdjacentHTML('beforeend', html);
    else longsEl.insertAdjacentHTML('beforeend', html);
  }

  renderPagination();
}

function renderPagination(){
  const totalPages = Math.ceil(allRows.length / itemsPerPage);
  const container = document.getElementById('pagination');
  container.innerHTML = "";
  if(totalPages <= 1) return;

  for(let i=1; i<=totalPages; i++){
    const btn = document.createElement('button');
    btn.textContent = i;
    if(i === currentPage) btn.style.background = "#e60023";
    btn.onclick = ()=>{ currentPage=i; renderPage(currentPage); };
    container.appendChild(btn);
  }
}

document.getElementById('searchBtn').addEventListener('click', onSearch);

async function onSearch(){
  apiUsage++;
  updateUsage();
  document.getElementById('status').textContent = "ê²€ìƒ‰ ì¤‘...";

  const q = document.getElementById('q').value.trim();
  if(!q){ alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

  const sUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(q)}&maxResults=30&key=${API_KEY}`;
  const sRes = await fetch(sUrl);
  const sData = await sRes.json();

  allRows = sData.items.map(it=>{
    return {
      id: it.id.videoId,
      title: it.snippet.title,
      thumbnail: it.snippet.thumbnails.medium.url,
      kind: 'video',
      isShort: Math.random()>0.5, // ì˜ˆì‹œìš© (ì‹¤ì œëŠ” duration ê¸°ë°˜)
      isMid: false,
      isLong: Math.random()>0.5
    }
  });

  currentPage = 1;
  renderPage(currentPage);
  document.getElementById('status').textContent = `${allRows.length}ê°œì˜ ê²°ê³¼`;
}

function renderCard(r){
  return `<div class="card">
    <div><img class="thumb" src="${r.thumbnail}"></div>
    <div><div class="title">${r.title}</div></div>
  </div>`;
}
</script>
</body>
</html>
